{"version":3,"file":"project-controller.js","sourceRoot":"","sources":["../../src/controller/project-controller.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,sCAAsC;;;;AAEtC,0DAA0B;AAC1B,oCAAqC;AAK9B,MAAM,YAAY,GAAG,CAAC,KAAa,EAAE,EAAE;IAC5C,OAAO,KAAK;SACT,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC;SAC7B,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;SACpB,WAAW,EAAE,CAAC;AACnB,CAAC,CAAC;AALW,QAAA,YAAY,gBAKvB;AACK,KAAK,UAAU,aAAa,CACjC,YAAoB,EACpB,QAAgB,EAChB,OAAe,EACf,YAAoB,EACpB,SAAiB,EACjB,aAAqB,EACrB,WAAmB,EACnB,UAAkB,EAClB,UAA8B,EAC9B,GAAW;IAEX,IAAI;QACF,MAAM,MAAM,GAAG,CACb,MAAM,IAAA,eAAK,EAAC;YACV,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU,SAAS,EAAE;aACrC;YACD,MAAM,EAAE,MAAM;YACd,GAAG,EAAE,YAAY;YACjB,OAAO,EAAE,GAAG;YACZ,IAAI,EAAE;gBACJ,UAAU,EAAE,IAAI,UAAU,EAAE;gBAC5B,WAAW,EAAE,WAAW;gBACxB,aAAa,EAAE,aAAa;gBAC5B,GAAG,EAAE,GAAG,YAAY,IAAI,IAAA,oBAAY,EAAC,YAAY,CAAC,EAAE;gBACpD,OAAO,EAAE,OAAO;gBAChB,IAAI,EAAE,YAAY;gBAClB,QAAQ,EAAE,QAAQ;gBAClB,aAAa,EAAE,UAAU;aAC1B;SACF,CAAC,CACH,CAAC,IAAI,CAAC;QACP,OAAO,MAAM,CAAC;KACf;IAAC,OAAO,CAAC,EAAE;QACV,IAAA,mBAAW,EAAC,CAAC,EAAE,2BAA2B,CAAC,CAAC;KAC7C;AACH,CAAC;AArCD,sCAqCC;AAEM,KAAK,UAAU,aAAa,CACjC,SAAiB,EACjB,YAAoB,EACpB,YAAoB,EACpB,GAAW;IAEX,MAAM,GAAG,GAAG,GAAG,YAAY,IAAI,YAAY,EAAE,CAAC;IAC9C,IAAI;QACF,MAAM,IAAA,eAAK,EAAC;YACV,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU,SAAS,EAAE;aACrC;YACD,MAAM,EAAE,QAAQ;YAChB,GAAG,EAAE,cAAc,GAAG,EAAE;YACxB,OAAO,EAAE,GAAG;SACb,CAAC,CAAC;QACH,OAAO,GAAG,GAAG,EAAE,CAAC;KACjB;IAAC,OAAO,CAAC,EAAE;QACV,IAAA,mBAAW,EAAC,CAAC,EAAE,2BAA2B,CAAC,CAAC;KAC7C;AACH,CAAC;AApBD,sCAoBC","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport axios from 'axios';\nimport {errorHandle} from '../utils';\n\ninterface createProjectType {\n  key: string;\n}\nexport const suffixFormat = (value: string) => {\n  return value\n    .replace(/(^\\s*)|(\\s*$)/g, '')\n    .replace(/\\s+/g, '-')\n    .toLowerCase();\n};\nexport async function createProject(\n  organization: string,\n  subtitle: string,\n  logoUrl: string,\n  project_name: string,\n  authToken: string,\n  gitRepository: string,\n  description: string,\n  apiVersion: string,\n  dedicateDB: string | undefined,\n  url: string\n): Promise<createProjectType> {\n  try {\n    const result = (\n      await axios({\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n        },\n        method: 'post',\n        url: 'subqueries',\n        baseURL: url,\n        data: {\n          apiVersion: `v${apiVersion}`,\n          description: description,\n          gitRepository: gitRepository,\n          key: `${organization}/${suffixFormat(project_name)}`,\n          logoUrl: logoUrl,\n          name: project_name,\n          subtitle: subtitle,\n          dedicateDBKey: dedicateDB,\n        },\n      })\n    ).data;\n    return result;\n  } catch (e) {\n    errorHandle(e, 'Failed to create project:');\n  }\n}\n\nexport async function deleteProject(\n  authToken: string,\n  organization: string,\n  project_name: string,\n  url: string\n): Promise<string> {\n  const key = `${organization}/${project_name}`;\n  try {\n    await axios({\n      headers: {\n        Authorization: `Bearer ${authToken}`,\n      },\n      method: 'delete',\n      url: `subqueries/${key}`,\n      baseURL: url,\n    });\n    return `${key}`;\n  } catch (e) {\n    errorHandle(e, 'Failed to delete project:');\n  }\n}\n"]}