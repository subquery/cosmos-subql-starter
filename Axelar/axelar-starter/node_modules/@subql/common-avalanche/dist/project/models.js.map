{"version":3,"file":"models.js","sourceRoot":"","sources":["../../src/project/models.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport {RegisteredTypes, RegistryTypes, OverrideModuleType, OverrideBundleType} from '@polkadot/types/types';\n\nimport {BaseMapping} from '@subql/common';\nimport {\n  AvalancheLogFilter,\n  AvalancheHandlerKind,\n  SubqlCustomHandler,\n  SubqlMapping,\n  SubqlHandler,\n  SubqlRuntimeHandler,\n  SubqlRuntimeDatasource,\n  AvalancheDatasourceKind,\n  SubqlCustomDatasource,\n  FileReference,\n  CustomDataSourceAsset,\n  AvalancheBlockFilter,\n  SubqlBlockHandler,\n  SubqlEventHandler,\n  SubqlCallHandler,\n  AvalancheTransactionFilter,\n  SubqlDatasource,\n} from '@subql/types-avalanche';\nimport {plainToClass, Transform, Type} from 'class-transformer';\nimport {\n  ArrayMaxSize,\n  IsArray,\n  IsBoolean,\n  IsEnum,\n  IsInt,\n  IsOptional,\n  IsString,\n  IsObject,\n  ValidateNested,\n} from 'class-validator';\n\nexport class BlockFilter implements AvalancheBlockFilter {\n  @IsOptional()\n  @IsInt()\n  modulo?: number;\n}\n\nexport class LogFilter implements AvalancheLogFilter {\n  @IsOptional()\n  @IsArray()\n  topics?: string[];\n  @IsOptional()\n  @IsString()\n  address?: string;\n}\n\nexport class ChainTypes implements RegisteredTypes {\n  @IsObject()\n  @IsOptional()\n  types?: RegistryTypes;\n  @IsObject()\n  @IsOptional()\n  typesAlias?: Record<string, OverrideModuleType>;\n  @IsObject()\n  @IsOptional()\n  typesBundle?: OverrideBundleType;\n  @IsObject()\n  @IsOptional()\n  typesChain?: Record<string, RegistryTypes>;\n  @IsObject()\n  @IsOptional()\n  typesSpec?: Record<string, RegistryTypes>;\n}\n\nexport class TransactionFilter implements AvalancheTransactionFilter {\n  @IsOptional()\n  @IsString()\n  from?: string;\n  @IsOptional()\n  @IsString()\n  to?: string;\n  @IsOptional()\n  @IsString()\n  function?: string;\n}\n\nexport class BlockHandler implements SubqlBlockHandler {\n  @IsObject()\n  @IsOptional()\n  @Type(() => BlockFilter)\n  filter?: BlockFilter;\n  @IsEnum(AvalancheHandlerKind, {groups: [AvalancheHandlerKind.Block]})\n  kind: AvalancheHandlerKind.Block;\n  @IsString()\n  handler: string;\n}\n\nexport class CallHandler implements SubqlCallHandler {\n  @IsObject()\n  @IsOptional()\n  @Type(() => TransactionFilter)\n  filter?: TransactionFilter;\n  @IsEnum(AvalancheHandlerKind, {groups: [AvalancheHandlerKind.Call]})\n  kind: AvalancheHandlerKind.Call;\n  @IsString()\n  handler: string;\n}\n\nexport class EventHandler implements SubqlEventHandler {\n  @IsObject()\n  @IsOptional()\n  @Type(() => LogFilter)\n  filter?: LogFilter;\n  @IsEnum(AvalancheHandlerKind, {groups: [AvalancheHandlerKind.Event]})\n  kind: AvalancheHandlerKind.Event;\n  @IsString()\n  handler: string;\n}\n\nexport class CustomHandler implements SubqlCustomHandler {\n  @IsString()\n  kind: string;\n  @IsString()\n  handler: string;\n  @IsObject()\n  @IsOptional()\n  filter?: Record<string, unknown>;\n}\n\nexport class AvalancheMapping implements SubqlMapping {\n  @Transform((params) => {\n    const handlers: SubqlHandler[] = params.value;\n    return handlers.map((handler) => {\n      switch (handler.kind) {\n        case AvalancheHandlerKind.Event:\n          return plainToClass(EventHandler, handler);\n        case AvalancheHandlerKind.Call:\n          return plainToClass(CallHandler, handler);\n        case AvalancheHandlerKind.Block:\n          return plainToClass(BlockHandler, handler);\n        default:\n          throw new Error(`handler ${(handler as any).kind} not supported`);\n      }\n    });\n  })\n  @IsArray()\n  @ValidateNested()\n  handlers: SubqlHandler[];\n  @IsString()\n  file: string;\n}\n\nexport class CustomMapping implements SubqlMapping<SubqlCustomHandler> {\n  @IsArray()\n  @Type(() => CustomHandler)\n  @ValidateNested()\n  handlers: CustomHandler[];\n  @IsString()\n  file: string;\n}\n\nexport class RuntimeDataSourceBase<M extends SubqlMapping<SubqlRuntimeHandler>> implements SubqlRuntimeDatasource<M> {\n  @IsEnum(AvalancheDatasourceKind, {groups: [AvalancheDatasourceKind.Runtime]})\n  kind: AvalancheDatasourceKind.Runtime;\n  @Type(() => AvalancheMapping)\n  @ValidateNested()\n  mapping: M;\n  @IsOptional()\n  @IsInt()\n  startBlock?: number;\n  @IsOptional()\n  assets?: Map<string, FileReference>;\n  @IsOptional()\n  options?: any;\n}\n\nexport class FileReferenceImpl implements FileReference {\n  @IsString()\n  file: string;\n}\n\nexport class CustomDataSourceBase<K extends string, M extends SubqlMapping = SubqlMapping<SubqlCustomHandler>>\n  implements SubqlCustomDatasource<K, M>\n{\n  @IsString()\n  kind: K;\n  @Type(() => CustomMapping)\n  @ValidateNested()\n  mapping: M;\n  @IsOptional()\n  @IsInt()\n  startBlock?: number;\n  @Type(() => FileReferenceImpl)\n  @ValidateNested({each: true})\n  assets: Map<string, CustomDataSourceAsset>;\n  @Type(() => FileReferenceImpl)\n  @IsObject()\n  processor: FileReference;\n}\n"]}