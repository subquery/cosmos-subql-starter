{"version":3,"file":"model.js","sourceRoot":"","sources":["../../../../src/project/versioned/v1_0_0/model.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,sCAAsC;;;;;;;;;;;;AAEtC,0CAOuB;AACvB,yDAAqD;AACrD,qDAUyB;AAEzB,sCAKmB;AAGnB,MAAM,gBAAgB,GAAG,oBAAoB,CAAC;AAE9C,MAAa,6BACX,SAAQ,0CAAiC;CAK1C;AAFC;IAAC,IAAA,0BAAQ,GAAE;;2DACE;AALf,sEAMC;AAED,MAAa,4BAA6B,SAAQ,yCAAgC;CAGjF;AAFC;IAAC,IAAA,0BAAQ,GAAE;;0DACE;AAFf,oEAGC;AAED,MAAa,oBAAoB;CAMhC;AALC;IAAC,IAAA,wBAAM,EAAC,gBAAgB,EAAE,EAAC,OAAO,EAAE,kDAAkD,gBAAgB,GAAG,EAAC,CAAC;;kDAC9F;AACb;IAAC,IAAA,0BAAQ,EAAC,+BAAsB,CAAC;IACjC,yBAAyB;;;qDACT;AALlB,oDAMC;AAED,MAAa,qBAAqB;CASjC;AARC;IAAC,IAAA,0BAAQ,GAAE;IACV,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,oBAAoB,CAAC;;mDAClB;AACf;IAAC,IAAA,0BAAQ,GAAE;IACV,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,6BAAoB,CAAC;;oDAChB;AARnB,sDASC;AAED,MAAa,gBAAiB,SAAQ,yBAAgB;CAmBrD;AAlBC;IAAC,IAAA,wBAAM,EAAC,OAAO,CAAC;IACf,IAAA,0BAAQ,GAAE;;qDACS;AACpB;IAAC,IAAA,0BAAQ,GAAE;IACV,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,qBAAqB,CAAC;;gDACd;AACpB;IAAC,IAAA,4BAAU,GAAE;IACZ,IAAA,yBAAO,GAAE;IACT,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,4BAA4B,EAAE;QACxC,aAAa,EAAE;YACb,QAAQ,EAAE,MAAM;YAChB,QAAQ,EAAE,CAAC,EAAC,KAAK,EAAE,6BAA6B,EAAE,IAAI,EAAE,gBAAgB,EAAC,CAAC;SAC3E;QACD,yBAAyB,EAAE,IAAI;KAChC,CAAC;;mDACmE;AAlBvE,4CAmBC;AAED,MAAa,yBAA0B,SAAQ,kCAAyB;IAkBtE,IAAI,UAAU;QACZ,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,WAAW,GAAG,IAAA,gCAAY,EAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;YACxD,IAAA,8BAAY,EAAC,IAAI,CAAC,WAAW,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAC;SACnD;QACD,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;CACF;AAxBC;IAAC,IAAA,4BAAU,GAAE;IACZ,IAAA,yBAAO,GAAE;IACT,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,4BAA4B,EAAE;QACxC,aAAa,EAAE;YACb,QAAQ,EAAE,MAAM;YAChB,QAAQ,EAAE,CAAC,EAAC,KAAK,EAAE,6BAA6B,EAAE,IAAI,EAAE,gBAAgB,EAAC,CAAC;SAC3E;QACD,yBAAyB,EAAE,IAAI;KAChC,CAAC;;4DACmE;AACrE;IAAC,IAAA,0BAAQ,GAAE;IACV,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,qBAAqB,CAAC;;yDACd;AAftB,8DAyBC","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport {\n  NodeSpec,\n  ProjectManifestBaseImpl,\n  QuerySpec,\n  RunnerQueryBaseModel,\n  RunnerSpecs,\n  SemverVersionValidator,\n} from '@subql/common';\nimport {plainToClass, Type} from 'class-transformer';\nimport {\n  Equals,\n  IsObject,\n  IsString,\n  Matches,\n  Validate,\n  ValidateNested,\n  validateSync,\n  IsOptional,\n  IsArray,\n} from 'class-validator';\nimport {RuntimeDatasourceTemplate, CustomDatasourceTemplate} from '../v0_2_1';\nimport {\n  DeploymentV0_3_0,\n  ProjectManifestV0_3_0Impl,\n  CosmosCustomDataSourceV0_3_0Impl,\n  CosmosRuntimeDataSourceV0_3_0Impl,\n} from '../v0_3_0';\nimport {CosmosProjectManifestV1_0_0} from '../v1_0_0';\n\nconst COSMOS_NODE_NAME = `@subql/node-cosmos`;\n\nexport class RuntimeDatasourceTemplateImpl\n  extends CosmosRuntimeDataSourceV0_3_0Impl\n  implements RuntimeDatasourceTemplate\n{\n  @IsString()\n  name: string;\n}\n\nexport class CustomDatasourceTemplateImpl extends CosmosCustomDataSourceV0_3_0Impl implements CustomDatasourceTemplate {\n  @IsString()\n  name: string;\n}\n\nexport class CosmosRunnerNodeImpl implements NodeSpec {\n  @Equals(COSMOS_NODE_NAME, {message: `Runner Cosmos node name incorrect, suppose be '${COSMOS_NODE_NAME}'`})\n  name: string;\n  @Validate(SemverVersionValidator)\n  // @Matches(RUNNER_REGEX)\n  version: string;\n}\n\nexport class CosmosRunnerSpecsImpl implements RunnerSpecs {\n  @IsObject()\n  @ValidateNested()\n  @Type(() => CosmosRunnerNodeImpl)\n  node: NodeSpec;\n  @IsObject()\n  @ValidateNested()\n  @Type(() => RunnerQueryBaseModel)\n  query: QuerySpec;\n}\n\nexport class DeploymentV1_0_0 extends DeploymentV0_3_0 {\n  @Equals('1.0.0')\n  @IsString()\n  specVersion: string;\n  @IsObject()\n  @ValidateNested()\n  @Type(() => CosmosRunnerSpecsImpl)\n  runner: RunnerSpecs;\n  @IsOptional()\n  @IsArray()\n  @ValidateNested()\n  @Type(() => CustomDatasourceTemplateImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [{value: RuntimeDatasourceTemplateImpl, name: 'cosmos/Runtime'}],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  templates?: (RuntimeDatasourceTemplate | CustomDatasourceTemplate)[];\n}\n\nexport class ProjectManifestV1_0_0Impl extends ProjectManifestV0_3_0Impl implements CosmosProjectManifestV1_0_0 {\n  @IsOptional()\n  @IsArray()\n  @ValidateNested()\n  @Type(() => CustomDatasourceTemplateImpl, {\n    discriminator: {\n      property: 'kind',\n      subTypes: [{value: RuntimeDatasourceTemplateImpl, name: 'cosmos/Runtime'}],\n    },\n    keepDiscriminatorProperty: true,\n  })\n  templates?: (RuntimeDatasourceTemplate | CustomDatasourceTemplate)[];\n  @IsObject()\n  @ValidateNested()\n  @Type(() => CosmosRunnerSpecsImpl)\n  runner: RunnerSpecs;\n  protected _deployment: DeploymentV1_0_0;\n\n  get deployment(): DeploymentV1_0_0 {\n    if (!this._deployment) {\n      this._deployment = plainToClass(DeploymentV1_0_0, this);\n      validateSync(this._deployment, {whitelist: true});\n    }\n    return this._deployment;\n  }\n}\n"]}