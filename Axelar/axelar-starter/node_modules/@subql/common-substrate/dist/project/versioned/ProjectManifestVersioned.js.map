{"version":3,"file":"ProjectManifestVersioned.js","sourceRoot":"","sources":["../../../src/project/versioned/ProjectManifestVersioned.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020-2022 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport {SubstrateDatasource} from '@subql/types';\nimport {plainToClass} from 'class-transformer';\nimport {ISubstrateProjectManifest} from '../types';\nimport {ProjectManifestV0_0_1Impl, RuntimeDataSourceV0_0_1} from './v0_0_1';\nimport {ProjectManifestV0_2_0Impl} from './v0_2_0';\nimport {ProjectManifestV0_2_1Impl} from './v0_2_1';\nimport {ProjectManifestV0_3_0Impl} from './v0_3_0';\nimport {ProjectManifestV1_0_0Impl} from './v1_0_0';\nexport type VersionedProjectManifest = {specVersion: string};\n\nconst SUBSTRATE_SUPPORTED_VERSIONS = {\n  '0.0.1': ProjectManifestV0_0_1Impl,\n  '0.2.0': ProjectManifestV0_2_0Impl,\n  '0.2.1': ProjectManifestV0_2_1Impl,\n  '0.3.0': ProjectManifestV0_3_0Impl,\n  '1.0.0': ProjectManifestV1_0_0Impl,\n};\n\ntype Versions = keyof typeof SUBSTRATE_SUPPORTED_VERSIONS;\n\ntype ProjectManifestImpls = InstanceType<typeof SUBSTRATE_SUPPORTED_VERSIONS[Versions]>;\n\nexport function manifestIsV0_0_1(manifest: ISubstrateProjectManifest): manifest is ProjectManifestV0_0_1Impl {\n  return manifest.specVersion === '0.0.1';\n}\n\nexport function manifestIsV0_2_0(manifest: ISubstrateProjectManifest): manifest is ProjectManifestV0_2_0Impl {\n  return manifest.specVersion === '0.2.0';\n}\n\nexport function manifestIsV0_2_1(manifest: ISubstrateProjectManifest): manifest is ProjectManifestV0_2_1Impl {\n  return manifest.specVersion === '0.2.1';\n}\n\nexport function manifestIsV0_3_0(manifest: ISubstrateProjectManifest): manifest is ProjectManifestV0_3_0Impl {\n  return manifest.specVersion === '0.3.0';\n}\n\nexport function manifestIsV1_0_0(manifest: ISubstrateProjectManifest): manifest is ProjectManifestV1_0_0Impl {\n  return manifest.specVersion === '1.0.0';\n}\n\nexport class SubstrateProjectManifestVersioned implements ISubstrateProjectManifest {\n  private _impl: ProjectManifestImpls;\n\n  constructor(projectManifest: VersionedProjectManifest) {\n    const klass = SUBSTRATE_SUPPORTED_VERSIONS[projectManifest.specVersion as Versions];\n    if (!klass) {\n      throw new Error('specVersion not supported for project manifest file');\n    }\n    this._impl = plainToClass<ProjectManifestImpls, VersionedProjectManifest>(klass, projectManifest);\n  }\n\n  get asImpl(): ProjectManifestImpls {\n    return this._impl;\n  }\n\n  get isV0_0_1(): boolean {\n    return this.specVersion === '0.0.1';\n  }\n\n  get asV0_0_1(): ProjectManifestV0_0_1Impl {\n    return this._impl as ProjectManifestV0_0_1Impl;\n  }\n\n  get isV0_2_0(): boolean {\n    return this.specVersion === '0.2.0';\n  }\n\n  get asV0_2_0(): ProjectManifestV0_2_0Impl {\n    return this._impl as ProjectManifestV0_2_0Impl;\n  }\n\n  get isV0_2_1(): boolean {\n    return this.specVersion === '0.2.1';\n  }\n\n  get asV0_2_1(): ProjectManifestV0_2_1Impl {\n    return this._impl as ProjectManifestV0_2_1Impl;\n  }\n\n  get isV0_3_0(): boolean {\n    return this.specVersion === '0.3.0';\n  }\n\n  get asV0_3_0(): ProjectManifestV0_3_0Impl {\n    return this._impl as ProjectManifestV0_3_0Impl;\n  }\n\n  get isV1_0_0(): boolean {\n    return this.specVersion === '1.0.0';\n  }\n\n  get asV1_0_0(): ProjectManifestV1_0_0Impl {\n    return this._impl as ProjectManifestV1_0_0Impl;\n  }\n\n  toDeployment(): string | undefined {\n    return this._impl.toDeployment();\n  }\n\n  validate(): void {\n    return this._impl.validate();\n  }\n\n  get dataSources(): (SubstrateDatasource | RuntimeDataSourceV0_0_1)[] {\n    return this._impl.dataSources;\n  }\n\n  get schema(): string {\n    if (manifestIsV0_0_1(this._impl)) {\n      return this._impl.schema;\n    }\n\n    return this._impl.schema.file;\n  }\n\n  get specVersion(): string {\n    return this._impl.specVersion;\n  }\n\n  get description(): string {\n    return this._impl.description;\n  }\n\n  get repository(): string {\n    return this._impl.repository;\n  }\n}\n"]}